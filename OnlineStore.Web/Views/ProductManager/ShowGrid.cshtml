
@{
    Layout = null;
}

    <head>
        <!--<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>  -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
        <!--<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />-->

        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    </head>

<div class="container">  
    <br />  
    <div style="width:90%; margin:0 auto;">  
        <table id="example" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">  
            <thead>  
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>ModelNumber</th>
                <th>Category</th>
                <th>Price</th>
                <th>DiscountedPrice</th>
                <th>Quantity</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>  
            </thead>  
        </table>  
    </div>  
</div> 

<script>

    $(document).ready(function() {
        $("#example").DataTable({
            "processing": true,
            "serverSide": true,
            "filter": true,
            "orderMulti": false,
            "responsive": true,
            "displayLength": 10,
        
            "ajax": {
                "url": "/ProductManager/LoadData",
                "datatype": "JSON"
            },
            "columnDefs": [
            {
                "targets": [0],
                "visible": false,
                "searchable": false
            }
            ],
            "columns": [
                { "data": "id", "name": "Id", "autoWidth": true },
                { "data": "name", "name": "Name", "autoWidth": true },
                { "data": "modelNumber", "name": "ModelNumber", "autoWidth": true },
                { "data": "category", "name": "Category", "autoWidth": true },
                { "data": "price", "name": "Price", "autoWidth": true },
                { "data": "discountedPrice", "name": "DiscountedPrice", "autoWidth": true },
                { "data": "quantity", "name": "Quantity", "autoWidth": true },

            {
            orderable: false,
            "render": function (data, type, full, meta) { return "<a class='btn-floating mb-1 waves-effect waves-light' href='/ProductManager/Edit/" + full.id + "'><i class='material-icons'>edit</i></a>"; }
            },
            {
                orderable: false,
                data: null, render: function (data, type, row) {
                    return "<span class='btn-floating mb-1 btn-flat waves-effect waves-light red accent-2 white-text' onclick=DeleteData('" + row.id + "');> <i class='material-icons' style='color: blue;'>delete</i></a>";
                }
            },
            ],
        });
    });

    function DeleteData(entityId) {
        swal({
            title: "Are you sure?",
            text: "The selected row will be deleted",
            icon: "warning",
            dangerMode: true,
            buttons: {
                cancel: 'Cancel',
                delete: 'Ok'
            }
        }).then((willDelete) => {
            if (willDelete) {
                Delete(entityId);
            }
        });
    }

    function Delete(entityId) {
        var url = "?handler=delete";
        $.ajax({
            url: url,
            method: "POST",
            data: { entityId: entityId },
            headers: {
                RequestVerificationToken:
                    $('input:hidden[name="__RequestVerificationToken"]').val()
            },
            success: function (response) {
                if (response.IsSuccess === true) {
                    oTable = $('#page-length-option').DataTable();
                    oTable.draw();
                }
                else {
                    swal({
                        title: 'Error',
                        text: 'An Error occurred, please try again.',
                        icon: "warning",
                    });
                }
            }
        });
    }




















</script>